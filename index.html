<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Okinawa 2025 | Ê≤ñÁπ©Ë∑®Âπ¥Èö®Ë∫´ÊâãÂÜä</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vuedraggable@4.1.0/dist/vuedraggable.umd.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@700&family=Noto+Sans+TC:wght@300;400;700;900&display=swap');
        body { font-family: 'Noto Sans TC', sans-serif; background-color: #F4EBE2; color: #4A4A4A; overflow-x: hidden; }
        .content-up { margin-top: -60px; border-radius: 40px 40px 0 0; background-color: #F4EBE2; position: relative; z-index: 20; min-height: 100vh; padding-bottom: 120px; }
        .date-item.active { background-color: #0D9488; color: white; transform: scale(1.05); box-shadow: 0 10px 15px -3px rgba(13, 148, 136, 0.3); }
        .glass-nav { background: rgba(0, 0, 0, 0.3); backdrop-filter: blur(12px); border-radius: 25px; border: 1px solid rgba(255, 255, 255, 0.2); }
        .flight-card { background: linear-gradient(135deg, #0d9488 0%, #0f766e 100%); color: white; border-radius: 2rem; padding: 1.5rem; }
        .expense-input { border: none; background: transparent; font-weight: 700; outline: none; width: 100%; }
        [v-cloak] { display: none; }
    </style>
</head>
<body class="max-w-md mx-auto shadow-2xl">

<div id="app" v-cloak>
    <header class="relative w-full h-[250px] overflow-hidden">
        <img :src="bannerUrl" class="w-full h-full object-cover" alt="Banner">
        <div class="absolute bottom-20 right-4 flex gap-1 glass-nav p-1.5 z-30">
            <button @click="currentTab = 'schedule'" :class="tabClass('schedule')"><i data-lucide="map-pin" class="w-5 h-5"></i></button>
            <button @click="currentTab = 'info'" :class="tabClass('info')"><i data-lucide="info" class="w-5 h-5"></i></button>
            <button @click="currentTab = 'shopping'" :class="tabClass('shopping')"><i data-lucide="shopping-basket" class="w-5 h-5"></i></button>
            <button @click="currentTab = 'expense'" :class="tabClass('expense')"><i data-lucide="circle-dollar-sign" class="w-5 h-5"></i></button>
        </div>
    </header>

    <div class="content-up p-5">
        
        <div v-if="currentTab === 'schedule'">
            <div @click="openWeather" class="flex items-center justify-between bg-white/60 p-4 rounded-3xl mb-6 border border-white cursor-pointer active:scale-95 transition-transform">
                <div class="flex items-center gap-3">
                    <i data-lucide="cloud-sun" class="text-teal-500 w-10 h-10"></i>
                    <div>
                        <div class="text-2xl font-black text-teal-800">19¬∞C</div>
                        <div class="text-[10px] text-gray-500 font-bold uppercase tracking-wider">ÈÇ£Èú∏, Ê≤ñÁπ© ¬∑ ÈñãÂïüË©≥Á¥∞Â§©Ê∞£</div>
                    </div>
                </div>
                <i data-lucide="chevron-right" class="w-4 h-4 text-teal-600"></i>
            </div>

            <div class="flex overflow-x-auto gap-3 pb-6 no-scrollbar">
                <div v-for="date in dates" :key="date.full" @click="selectedDate = date.full"
                     :class="['date-item flex-shrink-0 w-16 h-20 rounded-2xl flex flex-col items-center justify-center transition-all bg-white shadow-sm border border-gray-100', selectedDate === date.full ? 'active' : '']">
                    <span class="text-[10px] font-black opacity-60">{{ date.weekday }}</span>
                    <span class="text-2xl font-black">{{ date.day }}</span>
                </div>
            </div>

            <draggable v-model="currentDayItems" item-key="id" handle=".drag-handle">
                <template #item="{element, index}">
                    <div>
                        <div v-if="index > 0" class="flex items-center gap-4 py-3 ml-12">
                            <i :data-lucide="element.transType === 'walk' ? 'walking' : 'car'" class="w-4 h-4 text-teal-300"></i>
                            <div class="h-[1px] flex-1 border-t border-dashed border-teal-100"></div>
                        </div>

                        <div v-if="element.type === 'Ëà™Áè≠'" class="flight-card shadow-xl mb-4">
                            <div class="flex justify-between items-center mb-4">
                                <span class="text-xs font-bold tracking-widest opacity-80 uppercase">{{ element.title }}</span>
                                <i data-lucide="plane" class="w-4 h-4"></i>
                            </div>
                            <div class="flex justify-between items-center text-center">
                                <div><div class="text-3xl font-black">{{ element.from }}</div><div class="text-sm opacity-80">{{ element.time.split('-')[0] }}</div></div>
                                <div class="flex-1 px-4 opacity-50"><div class="w-full h-[2px] bg-white"></div></div>
                                <div><div class="text-3xl font-black">{{ element.to }}</div><div class="text-sm opacity-80">{{ element.time.split('-')[1] }}</div></div>
                            </div>
                        </div>

                        <div v-else class="bg-white rounded-[30px] p-5 shadow-sm mb-2 relative flex gap-4 border border-white">
                            <div class="drag-handle cursor-grab opacity-20 flex items-center"><i data-lucide="grip-vertical" class="w-5 h-5"></i></div>
                            <div class="flex-1">
                                <div class="flex justify-between">
                                    <span class="text-[10px] font-black text-teal-600 bg-teal-50 px-2 py-0.5 rounded-lg uppercase tracking-tighter">{{ element.type }}</span>
                                    <span class="text-[10px] font-bold text-gray-300">{{ element.time }}</span>
                                </div>
                                <h3 class="font-black text-gray-800 text-lg mt-1">{{ element.title }}</h3>
                                <button @click="go(element.location)" class="w-full mt-4 bg-teal-500 text-white py-2.5 rounded-2xl text-xs font-bold flex items-center justify-center gap-2">
                                    <i data-lucide="navigation" class="w-4 h-4"></i> Â∞éËà™
                                </button>
                            </div>
                        </div>
                    </div>
                </template>
            </draggable>
        </div>

        <div v-if="currentTab === 'info'" class="space-y-4">
            <div class="bg-white p-6 rounded-[35px] shadow-sm">
                <h3 class="font-black text-gray-800 mb-4 flex items-center gap-2"><i data-lucide="refresh-ccw" class="text-teal-500"></i> ÂåØÁéáË®àÁÆóÊ©ü</h3>
                <input v-model="exchange.jpy" type="number" class="w-full bg-gray-50 p-4 rounded-2xl text-xl font-black outline-teal-500" placeholder="Ëº∏ÂÖ• JPY">
                <div class="bg-teal-600 text-white p-4 rounded-2xl mt-4 flex justify-between items-center">
                    <span class="font-bold">Âè∞Âπ£‰º∞Ë®à</span>
                    <span class="text-2xl font-black">NT$ {{ (exchange.jpy * 0.21).toFixed(0) }}</span>
                </div>
            </div>
            
            <div class="bg-white p-5 rounded-[30px] shadow-sm">
                <h3 class="font-black mb-3 text-teal-600">üè® ‰ΩèÂÆøË≥áË®ä</h3>
                <div v-for="hotel in hotels" class="border-b border-gray-50 py-3 last:border-0">
                    <div class="text-xs font-bold text-gray-400">{{ hotel.date }}</div>
                    <div class="text-gray-800 font-black">{{ hotel.name }}</div>
                </div>
            </div>

            <button @click="resetData" class="w-full py-4 text-red-300 text-xs font-bold border-2 border-dashed border-red-50 rounded-3xl mt-10">
                ÈáçÁΩÆÊâÄÊúâÂú®Âú∞ÂÑ≤Â≠òË≥áÊñô
            </button>
        </div>

        <div v-if="currentTab === 'shopping'" class="pb-20">
            <div class="grid grid-cols-2 gap-4">
                <div v-for="(item, idx) in shoppingList" :key="idx" class="bg-white rounded-3xl overflow-hidden shadow-sm border border-white">
                    <div class="h-40 bg-gray-100 relative">
                        <img v-if="item.img" :src="item.img" class="w-full h-full object-cover">
                        <div v-else class="w-full h-full flex items-center justify-center text-gray-300">
                            <i data-lucide="camera" class="w-8 h-8"></i>
                            <input type="file" @change="handleFileUpload($event, idx)" class="absolute inset-0 opacity-0 cursor-pointer" accept="image/*">
                        </div>
                        <button v-if="item.img" @click="item.img = null" class="absolute top-2 right-2 bg-black/50 text-white p-1 rounded-full"><i data-lucide="x" class="w-3 h-3"></i></button>
                    </div>
                    <div class="p-4 flex justify-between items-center">
                        <input v-model="item.name" class="w-full font-black text-sm border-none bg-transparent focus:ring-0 p-0" placeholder="ÂìÅÂêç...">
                        <button @click="shoppingList.splice(idx, 1)" class="text-red-200"><i data-lucide="trash-2" class="w-4 h-4"></i></button>
                    </div>
                </div>
                <div @click="addShoppingItem" class="border-2 border-dashed border-gray-200 rounded-3xl h-56 flex items-center justify-center text-gray-300">
                    <i data-lucide="plus-circle" class="w-10 h-10"></i>
                </div>
            </div>
        </div>

        <div v-if="currentTab === 'expense'">
            <div class="bg-teal-700 text-white p-8 rounded-[40px] mb-6 shadow-xl">
                <div class="text-[10px] font-black opacity-60 uppercase tracking-widest">Total Spent (JPY)</div>
                <div class="text-4xl font-black mt-1">¬• {{ totalExpenses.toLocaleString() }}</div>
                <div class="text-xs mt-3 bg-white/20 inline-block px-3 py-1 rounded-full">‚âà NT$ {{ (totalExpenses * 0.21).toLocaleString() }}</div>
            </div>
            
            <div class="space-y-3 pb-24">
                <div v-for="(ex, index) in expenses" :key="index" class="bg-white p-5 rounded-[25px] flex justify-between items-center shadow-sm">
                    <div class="flex items-center gap-4 flex-1">
                        <div class="w-10 h-10 bg-teal-50 text-teal-600 rounded-full flex items-center justify-center font-black text-xs">
                            <select v-model="ex.cat" class="bg-transparent border-none appearance-none font-black text-center w-full focus:ring-0">
                                <option>È£ü</option><option>Ëªä</option><option>Áé©</option><option>Ë≥º</option>
                            </select>
                        </div>
                        <div class="flex-1">
                            <input v-model="ex.name" class="expense-input text-gray-800 text-sm font-black" placeholder="ÂìÅÈ†ÖÂêçÁ®±...">
                            <div class="flex gap-2 mt-1">
                                <input v-model="ex.date" class="text-[10px] text-gray-400 font-bold bg-transparent w-12" placeholder="Êó•Êúü">
                                <select v-model="ex.pay" class="text-[10px] text-gray-400 font-bold bg-transparent">
                                    <option>‰ø°Áî®Âç°</option><option>ÁèæÈáë</option><option>ApplePay</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="text-right w-24">
                        <div class="flex items-center justify-end text-teal-600 font-black">
                            <span class="text-xs mr-1">¬•</span>
                            <input v-model.number="ex.amount" type="number" class="expense-input text-right w-full" placeholder="0">
                        </div>
                        <button @click="expenses.splice(index, 1)" class="text-[10px] text-red-300 font-bold mt-1">Âà™Èô§</button>
                    </div>
                </div>
            </div>
            <button @click="addExpense" class="fixed bottom-10 right-8 w-14 h-14 bg-teal-600 text-white rounded-full shadow-2xl flex items-center justify-center animate-bounce z-50">
                <i data-lucide="plus" class="w-8 h-8"></i>
            </button>
        </div>
    </div>
</div>

<script>
const { createApp, ref, computed, onMounted, nextTick, watch } = Vue;

createApp({
    components: { draggable: window.vuedraggable },
    setup() {
        // --- ÂàùÂßãÈ†êË®≠Ë≥áÊñô ---
        const defaultSchedule = [
            { id: 101, date: '2025-12-27', type: 'Ëà™Áè≠', title: 'Ë∂äÊç∑ VZ568', from:'TPE', to:'OKA', time: '14:45-17:10', location: 'Naha Airport', transType: 'none' },
            { id: 102, date: '2025-12-27', type: 'ÁßüËªä', title: 'COTÁßüËªä ÂèñËªä', time: '18:00', location: 'COT RENTACAR', transType: 'car' },
            { id: 103, date: '2025-12-27', type: 'ÊôØÈªû', title: 'ÁæéÂúãÊùëÁúãÁÖôÁÅ´', time: '20:00', location: 'American Village', transType: 'car' },
            { id: 201, date: '2025-12-28', type: 'ÁæéÈ£ü', title: 'ÁèÄÂ°îÁë™ ÂåóË∞∑Â∫ó', time: '08:00', location: 'Pork Tamago Onigiri Chatan', transType: 'car' }
        ];

        // --- ÁãÄÊÖãÂÆöÁæ© ---
        const bannerUrl = ref('Gemini_Generated_Image_rgp6cfrgp6cfrgp6.png');
        const currentTab = ref('schedule');
        const selectedDate = ref('2025-12-27');
        
        // --- ÂèØÂÑ≤Â≠òË≥áÊñô (Âæû localStorage ËÆÄÂèñÊàñ‰ΩøÁî®È†êË®≠ÂÄº) ---
        const getSaved = (key, def) => JSON.parse(localStorage.getItem(key)) || def;
        
        const exchange = ref(getSaved('ok_exchange', { jpy: 0 }));
        const scheduleItems = ref(getSaved('ok_schedule', defaultSchedule));
        const expenses = ref(getSaved('ok_expenses', []));
        const shoppingList = ref(getSaved('ok_shopping', []));

        const dates = [
            { full: '2025-12-27', weekday: 'SAT', day: '27' },
            { full: '2025-12-28', weekday: 'SUN', day: '28' },
            { full: '2025-12-29', weekday: 'MON', day: '29' },
            { full: '2025-12-30', weekday: 'TUE', day: '30' },
            { full: '2025-12-31', weekday: 'WED', day: '31' }
        ];

        const hotels = [
            { date: '12/27', name: 'Mr. Kinjo in Alaha Style' },
            { date: '12/28-29', name: '„Ç∞„É™„Éº„É≥„É™„ÉÉ„ÉÅ„Éõ„ÉÜ„É´Ê≤ñÁ∏ÑÂêçË≠∑' },
            { date: '12/30', name: 'Mr.KINJO Miki24 in ÁâßÂøóÈßÖÂâç' }
        ];

        // --- Áõ£ËÅΩË≥áÊñôËÆäÂãï‰∏¶Ëá™ÂãïÂ≠òÊ™î (Deep Watch) ---
        watch([exchange, scheduleItems, expenses, shoppingList], () => {
            localStorage.setItem('ok_exchange', JSON.stringify(exchange.value));
            localStorage.setItem('ok_schedule', JSON.stringify(scheduleItems.value));
            localStorage.setItem('ok_expenses', JSON.stringify(expenses.value));
            localStorage.setItem('ok_shopping', JSON.stringify(shoppingList.value));
        }, { deep: true });

        // --- Computed ---
        const currentDayItems = computed({
            get: () => scheduleItems.value.filter(i => i.date === selectedDate.value),
            set: (val) => {
                const otherDays = scheduleItems.value.filter(i => i.date !== selectedDate.value);
                scheduleItems.value = [...otherDays, ...val];
                nextTick(() => lucide.createIcons());
            }
        });

        const totalExpenses = computed(() => expenses.value.reduce((sum, i) => sum + (Number(i.amount) || 0), 0));

        // --- Methods ---
        const openWeather = () => {
            const isIOS = /iPhone|iPad|iPod/i.test(navigator.userAgent);
            window.location.href = isIOS ? "weather://" : "https://www.google.com/search?q=okinawa+weather";
        };

        const addExpense = () => {
            expenses.value.push({ cat: 'È£ü', name: '', amount: 0, date: selectedDate.value.slice(5), pay: 'ÁèæÈáë' });
            nextTick(() => lucide.createIcons());
        };

        const addShoppingItem = () => shoppingList.value.push({ name: '', img: null });

        const handleFileUpload = (event, index) => {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (e) => { shoppingList.value[index].img = e.target.result; };
                reader.readAsDataURL(file);
            }
        };

        const resetData = () => {
            if (confirm("Á¢∫ÂÆöË¶ÅÈáçÁΩÆÊâÄÊúâË≥áÊñôÂóéÔºüÈÄôÊúÉÊ∏ÖÈô§ÊâÄÊúâËá™Ë®ÇË°åÁ®ãËàáËä±Ë≤ªÔºÅ")) {
                localStorage.clear();
                location.reload();
            }
        };

        const go = (loc) => window.open(`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(loc)}`, '_blank');
        const tabClass = (tab) => `p-3 rounded-full transition-all ${currentTab.value === tab ? 'bg-white text-teal-600' : 'text-white opacity-40'}`;

        onMounted(() => lucide.createIcons());

        return {
            bannerUrl, currentTab, selectedDate, dates, scheduleItems, currentDayItems, hotels,
            shoppingList, expenses, totalExpenses, exchange, handleFileUpload, addShoppingItem, go, tabClass, openWeather, addExpense, resetData
        };
    }
}).mount('#app');
</script>
</body>
</html>
